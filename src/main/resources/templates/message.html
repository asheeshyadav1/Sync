<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Messaging</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f6eefc;
            color: #343a40;
        }
        .navbar {
            box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            height: 110px;
            background-color: #6a1b9a;
        }
        .navbar .nav-link {
            color: white;
        }
        .navbar .nav-link:hover {
            color: #d1c4e9;
        }
        .chat-container {
            margin-top: 120px;
            margin-bottom: 60px;
            display: flex;
            height: calc(100vh - 180px); /* Full height minus navbar and bottom nav */
        }
        .chat-list {
            flex: 1;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            max-height: 100%;
            background-color: #ffffff;
        }
        .chat-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .chat-item:hover {
            background-color: #f3e5f5;
        }
        .chat-box {
            flex: 3;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            height: 100%;
            overflow-y: auto;
        }
        .message-item {
            margin-bottom: 10px;
        }
        .message-sent {
            text-align: right;
        }
        .message-received {
            text-align: left;
        }
        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #ffffff;
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 60px;
            box-shadow: 0px -5px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .bottom-navigation a {
            text-decoration: none;
            color: #6a1b9a;
            display: block;
            text-align: center;
            line-height: 60px;
            width: 25%;
        }
        .bottom-navigation a.active {
            background-color: #6a1b9a;
            color: #ffffff;
        }
        .bottom-navigation a:hover {
            color: #ffffff;
        }
        .chat-item {
            color: #6a1b9a;
        }
        .chat-item:hover {
            background-color: #d1c4e9;
        }
        .message-input {
            margin-top: 20px;
            display: flex;
        }
        .message-input textarea {
            flex: 1;
            border-radius: 20px;
            border: 1px solid #6a1b9a;
            padding: 10px;
        }
        .message-input button {
            border-radius: 20px;
            margin-left: 10px;
            background-color: #6a1b9a;
            color: white;
            border: none;
        }
        .message-input button:hover {
            background-color: #4a0072;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/directMessaging">Direct Messaging</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link" href="/seeProfile">My Profile</a>
                </li>
                <li class="nav-item ms-3">
                    <a id="logoutBtn" class="nav-link" href="/userLogout">Logout</a>
                </li>
                <li class="nav-item ms-3">
                    <a class="nav-link" href="#">
                        <img src="/logo/profile logo.png" alt="Profile Picture" class="rounded-circle" width="40" height="40">
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="chat-container">
    <div class="chat-list">
        <div class="list-group">
            <a class="list-group-item list-group-item-action chat-item" href="#" th:each="friendMessage : ${friendMessages}"
               th:data-id="${friendMessage.login}" th:text="${friendMessage.login}" onclick="openChat(event)"></a>
        </div>
    </div>
    <div class="chat-box" id="chatBox">
        <div id="messagesContainer">
            <!-- Messages will be dynamically loaded here -->
        </div>
        <div class="message-input">
            <textarea class="form-control" id="messageInput" placeholder="Type a message..."></textarea>
            <button class="btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<div class="bottom-navigation">
    <a href="/login" class="home"><span class="btn"></span></a>
    <a href="./Like.html" class="like"><span class="btn"></span></a>
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            <span class="icon-gear"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
            <li><a id="deleteAccountBtn" class="dropdown-item" href="#">Delete Account</a></li>
            <li><a class="dropdown-item" href="/userEditAccount">Edit Account</a></li>
        </ul>
    </div>
    <a id="addfriends" href="#" class="add"><span class="btn"></span></a>
</div>

<script>
    // Set currentUser dynamically with Thymeleaf variable
    let currentUser = /*[[${user.login}]]*/ "YourUsername"; // Replace with Thymeleaf variable

    function openChat(event) {
        event.preventDefault();
        var friendLogin = event.currentTarget.getAttribute('data-id');
        var chatBox = document.getElementById('chatBox');
        var messagesContainer = document.getElementById('messagesContainer');

        // Clear previous messages
        messagesContainer.innerHTML = '';

        // Example of loading messages
        // This would normally be done via AJAX call to fetch messages
        messagesContainer.innerHTML = '<p>Chat with ' + friendLogin + '</p><p>Messages here...</p>';

        // Mark the clicked chat item as active
        var chatItems = document.querySelectorAll('.chat-item');
        chatItems.forEach(item => item.classList.remove('active'));
        event.currentTarget.classList.add('active');

        // Optionally, you can also scroll to the bottom of the chat box
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function sendMessage() {
        var messageInput = document.getElementById('messageInput');
        var messageText = messageInput.value.trim();

        if (messageText !== '') {
            var messagesContainer = document.getElementById('messagesContainer');
            var activeChatItem = document.querySelector('.chat-item.active');
            if (activeChatItem) {
                var friendLogin = activeChatItem.getAttribute('data-id');
                
                var messageElement = document.createElement('div');
                messageElement.className = 'message-item message-sent';
                messageElement.textContent = currentUser + ': ' + messageText;

                messagesContainer.appendChild(messageElement);

                // Clear the input field
                messageInput.value = '';

                // Scroll to the bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            } else {
                alert('Please select a chat to send a message.');
            }
        }
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
